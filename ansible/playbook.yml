---
- name: ğŸ”¥ Setup ACR and push images
  hosts: localhost
  connection: local
  gather_facts: false
  vars_files:
    - secrets.yml
  tasks:
    - name: ğŸ”‘ Login to Azure Container Registry
      include_role:
        name: acr

- name: ğŸš€ Configure Webserver on VM
  hosts: vm
  gather_facts: true
  vars_files:
    - secrets.yml
  tasks:
    - name: ğŸ“¦ Install Docker and deploy web server
      include_role:
        name: vm

- name: ğŸŒ Deploy App to AKS
  hosts: localhost
  connection: local
  gather_facts: false
  vars_files:
    - secrets.yml
  tasks:
    - name: ğŸ“¦ Deploy Kubernetes manifests
      include_role:
        name: aks

  vars:
    kubeconfig_path: "/home/fdelgado/.kube/aks-config.yaml"
    acr_name: "{{ lookup('env', 'ACR_NAME') }}"
    acr_username: "{{ lookup('env', 'ACR_USERNAME') }}"
    acr_password: "{{ lookup('env', 'ACR_PASSWORD') }}"